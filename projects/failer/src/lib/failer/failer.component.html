<table
  cdk-table
  [dataSource]="dataSource$ | async"
>
  <tbody>
    <tr
      cdk-header-row
      *cdkHeaderRowDef="displayedColumns"
    ></tr>
    <tr
      cdk-header-row
      *cdkHeaderRowDef="['method-control', 'url-control', 'code-control']; sticky: true"
    ></tr>
    <tr
      cdk-row
      *cdkRowDef="let row; columns: displayedColumns;"
      [class.red]="row.error"
      [attr.data-info]="row | json"
    ></tr>

    <ng-container cdkColumnDef="method">
      <th
        cdk-header-cell
        *cdkHeaderCellDef
        libSort
        (sort)="onSort($event, 'method')"
      >
        {{columnsHeaders.method}}
      </th>
      <td
        cdk-cell
        *cdkCellDef="let request"
      >
        {{request.requestMold.method}}
      </td>
    </ng-container>

    <ng-container cdkColumnDef="url">
      <th
        cdk-header-cell
        *cdkHeaderCellDef
        libSort
        (sort)="onSort($event, 'url')"
      >
        {{columnsHeaders.url}}
      </th>
      <td
        cdk-cell
        *cdkCellDef="let request"
      >
        {{request.requestMold.url}}
      </td>
    </ng-container>

    <ng-container cdkColumnDef="errorCode">
      <th
        cdk-header-cell
        *cdkHeaderCellDef
        libSort
        (sort)="onSort($event, 'error')"
      >
        {{columnsHeaders.errorCode}}
      </th>
      <td
        cdk-cell
        *cdkCellDef="let request"
      >
        <lib-error-selector
          [ngModel]="request.errorCode"
          (ngModelChange)="onErrorToggle($event, request)"
        ></lib-error-selector>
      </td>
    </ng-container>

    <ng-container cdkColumnDef="method-control">
      <th
        cdk-header-cell
        *cdkHeaderCellDef
      >
        <select [formControl]="filterForm.get('method')">
          <option value="any">any</option>
          <option value="GET">GET</option>
          <option value="POST">POST</option>
          <option value="PUT">PUT</option>
          <option value="PATCH">PATCH</option>
          <option value="DELETE">DELETE</option>
        </select>
      </th>
    </ng-container>

    <ng-container cdkColumnDef="url-control">
      <th
        cdk-header-cell
        *cdkHeaderCellDef
      >
        <input
          type="text"
          [formControl]="filterForm.get('url')"
        >
      </th>
    </ng-container>

    <ng-container cdkColumnDef="code-control">
      <th
        cdk-header-cell
        *cdkHeaderCellDef
      >
        <input
          type="text"
          [formControl]="filterForm.get('errorCode')"
        >
      </th>
    </ng-container>
  </tbody>
</table>
